angular.module("transportinator",["ui.router","ngResource"]);angular.module("transportinator").config(["$stateProvider","$urlRouterProvider",function(t,n){n.otherwise("/");t.state("routes",{url:"/",templateUrl:"app/transport/routes.html",controller:"routesController"}).state("route",{url:"/route/:id",templateUrl:"app/transport/routeInfo.html",controller:"routeInfoController"})}]);angular.module("transportinator").controller("routeInfoController",["$scope","$stateParams","routesService",function(t,n,r){t.routeId=n.id;r.getStopsForRoute(t.routeId).then(function(n){t.$apply(function(){t.stops=n})});r.getTripsForRoute(t.routeId).then(function(n){var r=_.sortBy(n,function(t){return t.stoptimes[0].departure_time});t.$apply(function(){t.trips=r})})}]);angular.module("transportinator").controller("routesController",["$scope","$location","routesService",function(t,n,r){t.testvar="Itsa Work!";r.getAllRoutes().then(function(n){t.$apply(function(){t.routes=n})});r.getAllStops().then(function(n){t.$apply(function(){t.stops=n})});t.fetchRouteUpdate=function(t){parseInt(t)<=6&&n.path("/route/"+t)}}]);angular.module("transportinator").factory("routesService",function(){var t;return{getAllRoutes:function(){return void 0!==t?t:fetch("/app/mtaData").then(function(t){return t.json()}).then(function(n){t=new Promise(function(t,r){n||r("No routes found");t(n)});return n})["catch"](function(t){console.log(t)})},getAllStops:function(){return fetch("/app/mtaStops").then(function(t){return t.json()}).then(function(t){return t})},getStopsForRoute:function(t){return fetch("/app/mtaStops/"+t).then(function(t){return t.json()}).then(function(t){return t})},getTripsForRoute:function(t){return fetch("/app/mtaTrips/"+t).then(function(t){return t.json()}).then(function(t){return t}).then(function(t){return new Promise(function(n,r){t&&0!==t.length||r("No trips found!");_.each(t,function(r){fetch("/app/mtaStopTimes/trip/"+r.trip_id).then(function(t){return t.json()}).then(function(e){r.stoptimes=e;t.indexOf(r)+1===t.length&&n(t)})})})})},getStopTimesByTrip:function(t){return fetch("/app/mtaStopTimes/trip/"+t).then(function(t){return t.json()}).then(function(t){return t})},getRouteUpdate:function(t){return fetch("/app/mtaUpdate/"+t).then(function(t){return t.json()}).then(function(n){var r={};r.timestamp=(new Date).getTime();var e=_.filter(n.entity,function(n){var r=!1;n.trip_update?n.trip_update.trip.route_id===t&&(r=!0):n.vehicle&&n.vehicle.trip.route_id===t&&(r=!0);return r});r.entities=e;return r})}}});angular.module("transportinator").factory("tripsService",[function(){var t,n={getAllTrips:function(){return fetch("/app/utaTrips").then(function(t){return t.json()}).then(function(n){t=n;return t})},getTripData:function(t){return fetch("/app/utaFullTrip/"+t).then(function(t){return t.json()})}};return n}]);