angular.module("eventinator",["ui.router","ngResource"]);angular.module("eventinator").config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/");e.state("main",{url:"/",templateUrl:"app/main/eventList.html"}).state("signup",{url:"/signup",templateUrl:"app/signup/eventSignup.html",controller:"eventSignupCtrl"})}]);angular.module("eventinator").controller("eventinatorCtrl",["$scope","eventIdentity","authService","$location",function(e,n,t,a){e.identity=n;e.signin=function(e,n){t.authenticateUser(e,n).then(function(e){e||$(".sign-in-error .help-block").css("opacity",1)})};e.signout=function(){t.logoutUser().then(function(){e.emial="";e.password="";a.path("/")})}}]);angular.module("eventinator").factory("addressService",function(){return{autocomplete:null,initAutocomplete:function(e){this.autocomplete=new google.maps.places.Autocomplete(document.getElementById(e),{types:["geocode"]})},geolocate:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var t={lat:n.coords.latitude,lng:n.coords.longitude},a=new google.maps.Circle({center:t,radius:n.coords.accuracy});e.autocomplete.setBounds(a.getBounds())})}}});angular.module("eventinator").factory("authService",["$q","$http","eventUser","eventIdentity",function(e,n,t,a){return{authenticateUser:function(o,r){var s=e.defer();n.post("/app/eventLogin",{email:o,password:r}).then(function(e){console.log(e.data);if(e.data.success){var n=new t;angular.extend(n,e.data.user);a.currentUser=n;s.resolve(!0)}else s.resolve(!1)});return s.promise},createEvtUser:function(n){var o=new t(n),r=e.defer();o.$save().then(function(){a.currentUser=o;r.resolve()},function(e){r.reject(e.data.excuse)});return r.promise},logoutUser:function(){var t=e.defer();n.post("/app/logout",{logout:!0}).then(function(){a.currentUser=void 0;t.resolve()});return t.promise}}}]);angular.module("eventinator").factory("eventIdentity",["$window","eventUser",function(e,n){var t;if(e.bootstrappedEventUser){t=new n;angular.extend(t,e.bootstrappedEventUser)}return{currentUser:t,authenticated:function(){return!!this.currentUser}}}]);angular.module("eventinator").controller("eventSignupCtrl",["$scope","$location","eventUser","authService","addressService",function(e,n,t,a,o){function r(e){var n=e.val(),t={upper:n.search(/[A-Z]/g)>-1,lower:n.search(/[a-z]/g)>-1,num:n.search(/[0-9]/g)>-1,punct:n.search(/[!#$@&\*\_ \.]/g)>-1,chars:n.length>=8,invalidChars:n.search(p)>-1};s(t,e)}function s(e,n){var t=$(".pass-confirm-container"),a=t.find(".requirement-box"),o=$(".pwd-popover").find(".arrow"),r=!1;a.removeClass("valid");o.removeClass("valid");e.upper&&t.find(".upper").addClass("valid");e.lower&&t.find(".lower").addClass("valid");if(e.num){t.find(".num").addClass("valid");o.addClass("valid")}e.punct&&t.find(".punct").addClass("valid");e.chars&&t.find(".chars").addClass("valid");e.upper&&e.lower&&e.num&&e.punct&&e.chars||(r=!0);if(e.invalidChars){r=!0;$(".password-error").text("The password you entered contains an invalid character.")}else $(".password-error").text("");l(n,r)}function i(e,n){var t=e.data("bs.popover");t.tip().find(".popover-content").text(n)}function l(n,t){var a=n.parents(".has-feedback"),o=a.find(".form-control-feedback");if(t){e.validForm=!1;a.removeClass("has-success");o.removeClass("glyphicon-ok");a.addClass("has-error");o.addClass("glyphicon-remove")}else{e.validForm=!0;a.removeClass("has-error");o.removeClass("glyphicon-remove");a.addClass("has-success");o.addClass("glyphicon-ok")}}e.validForm=!0;e.eventSignup=function(){var t={email:e.email,password:e.password,fullName:e.fullName,company:e.company,job:e.job,bday:e.bday,homeAddress:e.homeAddress},o=!1;c.each(function(){var e=$(this);e.hasClass("ng-invalid")&&(o=!0)});o||a.createEvtUser(t).then(function(){n.path("/")},function(e){console.log(e);$(".full-form-error").text(e)})};var c=$('#eventSignUpForm input[id!="password"]'),d=$("#password"),u=$("#confPass"),v=$("#homeAddr"),p=/[^A-z0-9\!\@\#\$\&\*\_ \.]/g;d.popover({container:"body",content:'<div class="pass-confirm-container"><div class="requirement-box upper">A</div><div class="requirement-box lower">a</div><div class="requirement-box num">0-9</div><div class="requirement-box punct">!&amp;?</div><div class="requirement-box chars">8+</div></div>',html:!0,placement:"top",trigger:"focus",template:'<div class="popover pwd-popover"><div class="arrow"></div><div class="popover-content"></div></div>'});u.popover({container:"body",content:"Confirm your password",html:!0,placement:"top",trigger:"focus"});$(function(){$("[data-toggle=popover]").popover()});c.on("focus keyup blur",function(e){var n=$(this);"focus"!==e.type&&n.val().length>0&&l(n,n.hasClass("ng-invalid"));n.hasClass("ng-invalid")?n.hasClass("ng-invalid-required")&&!n.hasClass("ng-pristine")?i(n,"Your "+n.attr("id")+" is required"):n.hasClass("ng-invalid-minlength")?i(n,"Must be at least "+n.attr("ng-minlength")+" characters"):n.hasClass("ng-invalid-email")&&i(n,"Invalid email address"):n.hasClass("ng-valid")&&n.val().length>0&&i(n,"Looks good!")});d.on("focus keyup",function(){r($(this))});u.on("focus keyup blur",function(){var n=$(this);l(n,e.password!==e.confPass);e.password!==e.confPass?i(n,"You passwords must match"):i(n,"We have a match!")});v.on("focus",function(){var n=$(this);o.initAutocomplete(n.attr("id"));o.geolocate();o.autocomplete.addListener("place_changed",function(){e.homeAddress=v.val()})})}]);angular.module("eventinator").factory("eventUser",["$resource",function(e){var n=e("/app/eventUsers/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return n}]);