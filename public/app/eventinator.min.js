angular.module("eventinator",["ui.router","ngResource"]);angular.module("eventinator").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/");e.state("main",{url:"/",templateUrl:"app/main/eventList.html"}).state("signup",{url:"/signup",templateUrl:"app/signup/eventSignup.html",controller:"eventSignupCtrl"})}]);angular.module("eventinator").controller("eventinatorCtrl",["$scope","eventIdentity","authService","$location",function(e,t,o,n){e.identity=t;e.signout=function(){o.logoutUser().then(function(){e.emial="";e.password="";n.path("/")})}}]);angular.module("eventinator").factory("addressService",function(){return{autocomplete:null,initAutocomplete:function(e){this.autocomplete=new google.maps.places.Autocomplete(document.getElementById(e),{types:["geocode"]})},geolocate:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var o={lat:t.coords.latitude,lng:t.coords.longitude},n=new google.maps.Circle({center:o,radius:t.coords.accuracy});e.autocomplete.setBounds(n.getBounds())})}}});angular.module("eventinator").factory("authService",["$q","$http","eventUser","eventIdentity",function(e,t,o,n){return{createEvtUser:function(t){var r=new o(t),a=e.defer();r.$save().then(function(){n.currentUser=r;a.resolve()},function(e){a.reject(e.data.reason)});return a.promise},logoutUser:function(){var o=e.defer();t.post("/app/logout",{logout:!0}).then(function(){n.currentUser=void 0;o.resolve()});return o.promise}}}]);angular.module("eventinator").factory("eventIdentity",["$window","eventUser",function(e,t){var o;if(e.bootstrappedEventUser){o=new t;angular.extend(o,e.bootstrappedEventUser)}return{currentUser:o,authenticated:function(){return!!this.currentUser}}}]);angular.module("eventinator").controller("eventSignupCtrl",["$scope","$location","eventUser","authService","addressService",function(e,t,o,n,r){function a(e){var t=e.val(),o={upper:t.search(/[A-Z]/g)>-1,lower:t.search(/[a-z]/g)>-1,num:t.search(/[0-9]/g)>-1,punct:t.search(/[!#$@&\*\_]/g)>-1,chars:t.length>=8,invalidChars:t.search(/[^A-z0-9\!\@\#\$\&\*\_]/g)>-1};s(o,e)}function s(e,t){var o=$(".pass-confirm-container"),n=o.find(".requirement-box"),r=$(".pwd-popover").find(".arrow"),a=!1;n.removeClass("valid");r.removeClass("valid");e.upper&&o.find(".upper").addClass("valid");e.lower&&o.find(".lower").addClass("valid");if(e.num){o.find(".num").addClass("valid");r.addClass("valid")}e.punct&&o.find(".punct").addClass("valid");e.chars&&o.find(".chars").addClass("valid");e.upper&&e.lower&&e.num&&e.punct&&e.chars||(a=!0);if(e.invalidChars){a=!0;$(".password-error").text("The password you entered contains an invalid character.")}else $(".password-error").text("");l(t,a)}function i(e,t){var o=e.data("bs.popover");o.tip().find(".popover-content").text(t)}function l(t,o){var n=t.parents(".has-feedback"),r=n.find(".form-control-feedback");if(o){e.validForm=!1;n.removeClass("has-success");r.removeClass("glyphicon-ok");n.addClass("has-error");r.addClass("glyphicon-remove")}else{e.validForm=!0;n.removeClass("has-error");r.removeClass("glyphicon-remove");n.addClass("has-success");r.addClass("glyphicon-ok")}}e.validForm=!0;e.eventSignup=function(){var o={email:e.email,password:e.password,fullName:e.fullName,company:e.company,job:e.job,bday:e.bday,homeAddress:e.homeAddress};n.createEvtUser(o).then(function(){t.path("/")},function(e){$(".full-form-error").text(e)})};var d=$('#eventSignUpForm input[id!="password"]'),c=$("#password"),u=$("#confPass"),v=$("#autocomplete");c.popover({container:"body",content:'<div class="pass-confirm-container"><div class="requirement-box upper">A</div><div class="requirement-box lower">a</div><div class="requirement-box num">0-9</div><div class="requirement-box punct">!&amp;?</div><div class="requirement-box chars">8+</div></div>',html:!0,placement:"top",trigger:"focus",template:'<div class="popover pwd-popover"><div class="arrow"></div><div class="popover-content"></div></div>'});u.popover({container:"body",content:"Confirm your password",html:!0,placement:"top",trigger:"focus"});$(function(){$("[data-toggle=popover]").popover()});d.on("keyup blur",function(){var e=$(this);l(e,e.hasClass("ng-invalid"));e.hasClass("ng-invalid")?e.hasClass("ng-invalid-required")?i(e,"Your "+e.attr("id")+" is required"):e.hasClass("ng-invalid-minlength")?i(e,"Must be at least "+e.attr("ng-minlength")+" characters"):e.hasClass("ng-invalid-email")&&i(e,"Invalid email address"):e.hasClass("ng-valid")&&i(e,"Looks good!")});c.on("focus keyup",function(){a($(this))});u.on("focus keyup blur",function(){var t=$(this);l(t,e.password!==e.confPass);e.password!==e.confPass?i(t,"You passwords must match"):i(t,"We have a match!")});v.on("focus",function(){var t=$(this);r.initAutocomplete(t.attr("id"));r.geolocate();r.autocomplete.addListener("place_changed",function(){e.homeAddress=v.val()})})}]);angular.module("eventinator").factory("eventUser",["$resource",function(e){var t=e("/app/eventUsers/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return t}]);