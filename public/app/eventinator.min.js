angular.module("eventinator",["ui.router","ngResource"]);angular.module("eventinator").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/");e.state("main",{url:"/",templateUrl:"app/main/eventList.html"}).state("signup",{url:"/signup",templateUrl:"app/signup/eventSignup.html",controller:"eventSignupCtrl"}).state("create",{url:"/create",templateUrl:"app/create/createEvent.html",controller:"createEventCtrl"})}]);angular.module("eventinator").controller("eventinatorCtrl",["$scope","eventIdentity","authService","$location",function(e,t,n,a){e.identity=t;e.signin=function(e,t){n.authenticateUser(e,t).then(function(e){e||$(".sign-in-error .help-block").css("opacity",1)})};e.signout=function(){n.logoutUser().then(function(){e.emial="";e.password="";a.path("/")})}}]);angular.module("eventinator").factory("addressService",function(){return{autocomplete:null,initAutocomplete:function(e){this.autocomplete=new google.maps.places.Autocomplete(document.getElementById(e),{types:["geocode"]})},geolocate:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude},a=new google.maps.Circle({center:n,radius:t.coords.accuracy});e.autocomplete.setBounds(a.getBounds())})}}});angular.module("eventinator").factory("authService",["$q","$http","eventUser","eventIdentity",function(e,t,n,a){return{authenticateUser:function(r,o){var s=e.defer();t.post("/app/eventLogin",{username:r,password:o}).then(function(e){if(e.data.success){var t=new n;angular.extend(t,e.data.user);a.currentUser=t;s.resolve(!0)}else s.resolve(!1)});return s.promise},createEvtUser:function(t){var r=new n(t),o=e.defer();r.$save().then(function(){a.currentUser=r;o.resolve()},function(e){o.reject(e.data.excuse)});return o.promise},logoutUser:function(){var n=e.defer();t.post("/app/logout",{logout:!0}).then(function(){a.currentUser=void 0;n.resolve()});return n.promise}}}]);angular.module("eventinator").controller("createEventCtrl",["$scope","addressService","events",function(e,t,n){e.eventHost=e.identity.currentUser.fullName;e.eventCreation=function(){var t={title:e.eventTitle,host:e.eventHost,type:e.eventType,start:e.eventStart,end:e.eventEnd,location:e.eventLocation,guests:e.guests,info:e.info},a=new n(t);a.$save().then(function(){},function(e){console.log(e.data.excuse,e.statusText);$(".full-form-error").text(e.statusText+" | "+e.data.excuse)})};var a=$("#location");a.on("focus",function(){var n=$(this);t.initAutocomplete(n.attr("id"));t.geolocate();t.autocomplete.addListener("place_changed",function(){e.eventLocation=a.val()})})}]);angular.module("eventinator").factory("eventIdentity",["$window","eventUser",function(e,t){var n;if(e.bootstrappedEventUser){n=new t;angular.extend(n,e.bootstrappedEventUser)}return{currentUser:n,authenticated:function(){return!!this.currentUser}}}]);angular.module("eventinator").controller("eventSignupCtrl",["$scope","$location","eventUser","authService","addressService",function(e,t,n,a,r){function o(e){var t=e.val(),n={upper:t.search(/[A-Z]/g)>-1,lower:t.search(/[a-z]/g)>-1,num:t.search(/[0-9]/g)>-1,punct:t.search(/[!#$@&\*\_ \.]/g)>-1,chars:t.length>=8,invalidChars:t.search(p)>-1};s(n,e)}function s(e,t){var n=$(".pass-confirm-container"),a=n.find(".requirement-box"),r=$(".pwd-popover").find(".arrow"),o=!1;a.removeClass("valid");r.removeClass("valid");e.upper&&n.find(".upper").addClass("valid");e.lower&&n.find(".lower").addClass("valid");if(e.num){n.find(".num").addClass("valid");r.addClass("valid")}e.punct&&n.find(".punct").addClass("valid");e.chars&&n.find(".chars").addClass("valid");e.upper&&e.lower&&e.num&&e.punct&&e.chars||(o=!0);if(e.invalidChars){o=!0;$(".password-error").text("The password you entered contains an invalid character.")}else $(".password-error").text("");c(t,o)}function i(e,t){var n=e.data("bs.popover");n.tip().find(".popover-content").text(t)}function c(t,n){var a=t.parents(".has-feedback"),r=a.find(".form-control-feedback");if(n){e.validForm=!1;a.removeClass("has-success");r.removeClass("glyphicon-ok");a.addClass("has-error");r.addClass("glyphicon-remove")}else{e.validForm=!0;a.removeClass("has-error");r.removeClass("glyphicon-remove");a.addClass("has-success");r.addClass("glyphicon-ok")}}e.validForm=!0;e.eventSignup=function(){var n={username:e.email,password:e.password,fullName:e.fullName,company:e.company,job:e.job,bday:e.bday,homeAddress:e.homeAddress},r=!1;l.each(function(){var e=$(this);e.hasClass("ng-invalid")&&(r=!0)});r||a.createEvtUser(n).then(function(){t.path("/")},function(e){$(".full-form-error").text(e)})};var l=$('#eventSignUpForm input[id!="password"]'),u=$("#password"),d=$("#confPass"),v=$("#homeAddr"),p=/[^A-z0-9\!\@\#\$\&\*\_ \.]/g;u.popover({container:"body",content:'<div class="pass-confirm-container"><div class="requirement-box upper">A</div><div class="requirement-box lower">a</div><div class="requirement-box num">0-9</div><div class="requirement-box punct">!&amp;?</div><div class="requirement-box chars">8+</div></div>',html:!0,placement:"top",trigger:"focus",template:'<div class="popover pwd-popover"><div class="arrow"></div><div class="popover-content"></div></div>'});d.popover({container:"body",content:"Confirm your password",html:!0,placement:"top",trigger:"focus"});$(function(){$("[data-toggle=popover]").popover()});l.on("focus keyup blur",function(e){var t=$(this);"focus"!==e.type&&t.val().length>0&&c(t,t.hasClass("ng-invalid"));t.hasClass("ng-invalid")?t.hasClass("ng-invalid-required")&&!t.hasClass("ng-pristine")?i(t,"Your "+t.attr("id")+" is required"):t.hasClass("ng-invalid-minlength")?i(t,"Must be at least "+t.attr("ng-minlength")+" characters"):t.hasClass("ng-invalid-email")&&i(t,"Invalid email address"):t.hasClass("ng-valid")&&t.val().length>0&&i(t,"Looks good!")});u.on("focus keyup",function(){o($(this))});d.on("focus keyup blur",function(){var t=$(this);c(t,e.password!==e.confPass);e.password!==e.confPass?i(t,"You passwords must match"):i(t,"We have a match!")});v.on("focus",function(){var t=$(this);r.initAutocomplete(t.attr("id"));r.geolocate();r.autocomplete.addListener("place_changed",function(){e.homeAddress=v.val()})})}]);angular.module("eventinator").factory("eventUser",["$resource",function(e){var t=e("/app/eventUsers/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return t}]);angular.module("eventinator").factory("events",["$resource",function(e){var t=e("app/createEvent/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return t}]);